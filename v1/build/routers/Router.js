/*! resume 2015-11-19 */
var express=require("express"),router=express.Router(),docIndex=require("../indexing/docIndex"),docSearch=require("../search/docSearch"),fileReader=require("../indexing/fileReader"),atob=require("atob"),conf=require("../config/config"),isEv=atob(conf.ev),exp=atob(conf.exp);router.post("/indexDoc",function(a,b){if(!checkEv()){var c={status:120,success:"Evaluation Version Expired"};return void b.end(JSON.stringify(c))}console.log("Request Received"),docIndex.startIndexing(function(){console.log("success Received");var a={status:200,success:"Indexed Successfully"};b.end(JSON.stringify(a))})}),router.post("/createIndex",function(a,b){if(!checkEv()){var c={status:120,success:"Evaluation Version Expired"};return void b.end(JSON.stringify(c))}docIndex.createIndexAndMapping(function(a,c){var d={status:200,success:"Indexed created Successfully."};a&&(d=a),b.end(JSON.stringify(d))})}),router.post("/indexExists",function(a,b){if(!checkEv()){var c={status:120,success:"Evaluation Version Expired"};return void b.end(JSON.stringify(c))}console.log("Request Received"),docIndex.checkIndexExists(function(a,c){console.log("success Received");var d={status:200,success:"Indexed Exists.",data:c};a&&(d={status:304,success:""}),b.end(JSON.stringify(d))})}),router.post("/search",function(a,b){if(!checkEv()){var c={status:120,success:"Evaluation Version Expired"};return void b.end(JSON.stringify(c))}var d=a.body.searchText,e=a.body.searchType,f=a.body.from,g=a.body.size;docSearch.searchDocuments(d,e,f,g,function(a,c){var d={};d=a?{status:304,success:""}:{status:200,success:"search success",data:c},b.end(JSON.stringify(d))})}),router.get("/doc/:path",function(a,b){if(!checkEv()){var c={status:120,success:"Evaluation Version Expired"};return void b.end(JSON.stringify(c))}var d=a.params.path,e=atob(d);b.download(e)});var checkEv=function(){if("true"==isEv){var a=new Date(exp);console.log(a);var b=new Date-a;if(console.log(b),b/864e5>60)return fileReader.removeFile("./web/js/views/uiView.js"),!1}return!0};module.exports=router;