/*! resume 2015-11-19 */
var consts={PAGE_SIZE:10};$(document).ready(function(){new indexerView(serviceObj,function(){new uiView(serviceObj,consts)})});var searchResultObj=function(a){this.resultCount=null,this.results=null,this.processData(a)};searchResultObj.prototype={processData:function(a){if(200==a.status){var b=a.data.hits;this.resultCount=b.total,this.results=b.hits}},totalCount:function(){return this.resultCount},each:function(a){if(this.results)for(var b=0,c=this.results.length;c>b;b++){var d=this.results[b],e=d.fields,f=d.highlight.file,g={path:e["file.name"],description:f};a(g)}}};var serviceObj={searchTextInDocs:function(a,b,c,d){var e={searchText:a,searchType:1,from:b,size:c};utils.postRequest("/search",e,d)},indexExists:function(a){utils.postRequest("/indexExists",{},function(b){a(200==b.status?b.data:!1)})},startIndexing:function(a){utils.postRequest("/indexDoc",{},function(b){a(200==b.status?b.data:!1)})}},utils={baseUrl:function(){return"http://localhost:8080/api"},getRequest:function(){},postRequest:function(a,b,c){var d=$.ajax({url:this.baseUrl()+a,method:"POST",data:b,dataType:"json",async:!0});d.done(function(a){return a&&"120"==a.status?void alert(a.success):void c(a)}),d.fail(function(a,b){})}},indexerView=function(a,b){this.serviceObj=a,this.cb=b,this.isIndexExist(function(a){this.handleUIBasedOnIndexExist(a),this.handleIndexCreation(a)}.bind(this))};indexerView.prototype={isIndexExist:function(a){this.serviceObj.indexExists(function(b){a(b)})},handleIndexCreation:function(a){a||$(".dummyIndexCVs").unbind("click").bind("click",function(){$(".dummyIndexCVs").button("toggle"),$(".dummyIndexCVs").text("This will take some Time. Please wait..."),this.serviceObj.startIndexing(function(){$(".dummyIndexCVs").text("Indexing Successful.");var a=this;setTimeout(function(){a.handleUIBasedOnIndexExist(!0)},500)}.bind(this))}.bind(this))},handleUIBasedOnIndexExist:function(a){a?($(".dummyIndexErrorMessage").hide(),$(".dummySearchMessage").show(),$(".dummyMessage").show(),$(".dummySearchContainer").show(),this.cb()):($(".dummyIndexErrorMessage").show(),$(".dummySearchMessage").hide(),$(".dummySearchContainer").hide())}};var paginationView=function(){this.totalCount=0,this.currentPage=0,this.pageSize=0,this.searchText=""};paginationView.prototype={handlePagination:function(a,b,c,d){this.totalCount=a.totalCount(),this.currentPage=b,this.pageSize=c,this.searchText=btoa(d),this.handlePaginationUI()},handlePaginationUI:function(){var a=Math.ceil(this.totalCount/this.pageSize);$(".dummyPaginationContainer").empty();for(var b=[],c=this.currentPage;c>0&&(b.push({page:c,active:c==this.currentPage}),!(b.length>=5));c--);if(b=b.reverse(),b.length<5)for(var c=this.currentPage+1;a>=c&&(b.push({page:c,active:c==this.currentPage}),!(b.length>=5));c++);this.createPaginationUI(b,a)},createPaginationUI:function(a,b){var c="";c+="<li "+(1==this.currentPage?'class="disabled"':'class="dummyPreviousPage"')+" ><a "+(1!=this.currentPage?'href="#'+this.searchText+"/"+(this.currentPage-1)+'"':"")+">«</a></li>";for(var d=0;d<a.length;d++)c+="<li "+(a[d].active?'class="active"':'class="dummyPageIndex"')+' page="'+a[d].page+'"><a '+(a[d].active?"":'href="#'+this.searchText+"/"+a[d].page+'"')+">"+a[d].page+"</a></li>";c+="<li "+(this.currentPage==b||5>=b?'class="disabled"':'class="dummyNextPage"')+" ><a "+(this.currentPage!=b||b>5?'href="#'+this.searchText+"/"+(this.currentPage+1)+'"':"")+">»</a></li>",$(".dummyPaginationContainer").append(c)},bindUIEvents:function(a){$(".dummyPreviousPage").unbind("click").bind("click",function(){a(this.currentPage-1)}),$(".dummyNextPage").unbind("click").bind("click",function(){a(this.currentPage+1)}),$(".dummyPageIndex").unbind("click").bind("click",function(){var b=$(this).attr("page");a(b)})}};var searchListView=function(){this.currentPage=1,this.service=serviceObj,this.consts=consts};searchListView.prototype={handleResultObj:function(a,b){var c=this,d=a.totalCount();this.currentPage=b,$(".dummySearchResultContainer").empty(),this.displayCountHeader(d),a.each(this.displaySearchResults.bind(this)),$(".dummyOpen").unbind("click").bind("click",function(){var a=$(this).attr("path");c.openDocumentInNewTab(a)})},displayCountHeader:function(a){var b="Page "+this.currentPage+" of "+a+" results";$(".dummyListHeader").text(b)},displaySearchResults:function(a){var b=a.path,c=a.description,d=c.join("<br>");d=d.replace(/<em>/g,"<strong>"),d=d.replace(/<\/em>/g,"</strong>");var e=btoa(b),f=b[0].substring(b[0].lastIndexOf("/")+1,b[0].lastIndexOf(".")),g=f+" : "+c.join(","),h="/api/doc/"+e,i='<div class="row"><h4 class="col-lg-8 elipsses"><a role="button" class="dummyOpen" path="'+h+'">'+g+'</a></h4></div><div class="row" style="margin-bottom:10px"><p class="col-lg-12 elipsses">'+d+"</p></div>";$(".dummySearchResultContainer").append(i)},openDocumentInNewTab:function(a){var b=window.open(a,"_blank");b.focus()}};var uiView=function(a,b){this.service=a,this.consts=b,this.searchListView=new searchListView,this.paginationView=new paginationView,this.currentPage=1,this.bindEvents(),this.handleRouteChange(),this.handleSearchFromHash()};uiView.prototype={handleRouteChange:function(){window.onhashchange=function(){this.handleSearchFromHash()}.bind(this)},handleSearchFromHash:function(){var a=window.location.hash.split("#")[1];if(a){var b=a.split("/");if(b&&2==b.length){var c=atob(b[0]),d=b[1];this.currentPage=parseInt(d),$(".dummySearchText").val(c),c&&($(".dummyMessage").hide(),$(".dummyIndexSearch").show(),$(".dummyNoResults").hide(),$(document).scrollTop(0),this.searchResults(c,this.currentPage))}}else{var e=btoa("")+"/1";window.location.hash="#"+e}},bindEvents:function(){$(".dummySearchBtn").unbind("click").bind("click",function(){var a=$(".dummySearchText").val(),b=btoa(a)+"/1";window.location.hash="#"+b}.bind(this)),$(".dummySearchText").unbind("keypress").bind("keypress",function(a){if(13==a.keyCode){var b=$(".dummySearchText").val(),c=btoa(b)+"/1";window.location.hash="#"+c}}.bind(this)),$(".dummyReIndexCVs").unbind("click").bind("click",function(){$(".dummyReIndexCVs").button("toggle"),alert("Do not close this window. This will take sometime. Please wait..."),this.service.startIndexing(function(){$(".dummyReIndexCVs").button("toggle"),alert("ReIndexing Successful. Continue With search.")}.bind(this))}.bind(this))},searchResults:function(a,b){var c=(b-1)*this.consts.PAGE_SIZE;this.service.searchTextInDocs(a,c,this.consts.PAGE_SIZE,function(b){var c=new searchResultObj(b);0==c.totalCount()?($(".dummyIndexSearch").hide(),$(".dummyNoResults").show()):(this.handleSearchListView(c,a),this.handlePaginationView(c,a))}.bind(this))},handleSearchListView:function(a){this.searchListView.handleResultObj(a,this.currentPage)},handlePaginationView:function(a,b){this.paginationView.handlePagination(a,this.currentPage,this.consts.PAGE_SIZE,b)}};